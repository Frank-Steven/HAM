# 第三章 函数、定义域与表达式（最终定稿）

## 3.1 一切都是 n 元函数
在 HAM 中，所有值都是 n 元函数，n 为自然数。
- 0 元函数：不需要参数 → 即常量
- 1 元函数：接收 1 个参数
- 2 元函数：接收 2 个参数
……

常量 ≡ 无参函数，二者完全等价。

## 3.2 两条语法糖
1. 单参数括号可省略
`(x) => e` 等价于 `x => e`

2. 无参调用括号可写、可不写、可重复
`f` 等价于 `f()` 等价于 `f()()()…`

## 3.3 or 按定义域贪婪匹配
or 是二元运算符，作用：
将多个不同元数、不同定义域的函数，拼接成一个整体函数。

匹配规则：
1. 检查传入参数个数
2. 左侧函数能接受 → 匹配成功
3. 不能接受 → 匹配失败，尝试右侧
4. 直到找到可匹配函数

## 3.4 表达式优先级（从高到低）
1. 括号 ( )
2. or
3. if
4. if … else …
5. 函数箭头 =>、参数分隔符 ,

or 优先级最高，最符合直觉。

---

## 3.5 示例 1：mod3
```ham
mod3 =
  (a,b,c) => 3
  or
  (a,b) => 2
  or
  (a) => 1
  or
  0
```
- `mod3`        → 0
- `mod3(1)`      → 1
- `mod3(1,2)`    → 2
- `mod3(1,2,3)`  → 3

---

## 3.6 示例 2：even（仅接受偶数个参数）
```ham
even =
  (a,b) => even
  or
  true
```
- `even`        → true
- `even(a)`     → 无匹配，报错
- `even(a,b)`   → true
- `even(a,b,c,d)` → true

---

## 3.7 示例 3：sum（正确结构）
```ham
sum =
  s => (x => sum(s + x) or s)
  or
  0
```
- `sum`         → 0
- `sum(1)`       → 1
- `sum(1)(2)`     → 3
- `sum(1)(2)(3)`   → 6

满足等价：
```ham
sum(1,2,3) === sum(1,2)(3)
```
---

## 3.8 调用的唯一规则
参数必须全部匹配、消耗完，否则报错。

所有调用错误，本质都是：
剩余参数无法被消耗。

---

## 3.9 定义域标注（语法糖）
参数后的 : 集合 是语法糖：
```ham
(x: Int) => e
```
等价于：
```ham
x => if (x ∈ Int) e
```
不写则默认为全集。

---

## 3.10 if 与 if else
### if
if (条件) 表达式
- 条件为 true → 取表达式
- 条件为 false → 此处未定义，匹配失败

### if else
```ham
if (条件) A else B
- 条件为 true → A
- 条件为 false → B
```
---

> **注**：`or` 和 `if else` 虽然表现为特殊形式，但它们与普通运算符一样，都是语法糖，最终会被编译器转换为基于函数调用的标准形式。例如，`if (c) A else B` 可视为一个三元函数 `ifElse(c, A, B)` 的语法糖，而 `or` 则可视为一个满足贪婪匹配规则的二元函数。这种统一性进一步强化了 HAM“一切皆函数”的核心思想。

## 第三章 小结
- 一切都是 n 元函数，常量 = 0 元函数
- or 优先级最高，用于拼接函数
- 按定义域贪婪匹配
- 括号用于保证结构正确
- 调用唯一错误：参数未用完
- 参数 : 集合 是 if(x∈集合) 的简写
